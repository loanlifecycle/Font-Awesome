machine:
  environment:
    FAILURE_FILE: /tmp/build_failures.txt
  node:
    version: 6.9.0

dependencies:
  pre:
    - sudo apt-get install --assume-yes --force-yes ruby-dev npm
    - sudo npm install -g grunt grunt-cli less less-plugin-clean-css
  override:
    - npm install || ( touch $FAILURE_FILE && exit 1 )
    - bundle install || ( touch $FAILURE_FILE && exit 1 )
  cache_directories:
    - "/opt/circleci/python/2.7.11/lib/python2.7/site-packages"
    - "~/Font-Awesome/node_modules"

test:
  override:
    - bundle exec jekyll build || ( touch $FAILURE_FILE && exit 1 )
  post:
    - cp "$HOME/Font-Awesome/dist/assets/font-awesome/font-awesome.zip" "$CIRCLE_ARTIFACTS/font-awesome.resource"
    - $DEPLOY_TOOLKIT/scripts/build_notifications.py
